From: Andrew Johnson <anj@aps.anl.gov>
Date: Thu, 26 May 2016 13:49:18 +0200
Subject: Fix lsi/lso puts with DBF_STRING data

---
 src/std/rec/lsiRecord.c | 7 ++++---
 src/std/rec/lsoRecord.c | 7 ++++---
 2 files changed, 8 insertions(+), 6 deletions(-)

diff --git a/src/std/rec/lsiRecord.c b/src/std/rec/lsiRecord.c
index 1cbff91..ee9e8e2 100644
--- a/src/std/rec/lsiRecord.c
+++ b/src/std/rec/lsiRecord.c
@@ -158,9 +158,10 @@ static long put_array_info(DBADDR *paddr, long nNew)
 {
     lsiRecord *prec = (lsiRecord *) paddr->precord;
 
-    if (nNew == prec->sizv)
-        --nNew;             /* truncated string */
-    prec->val[nNew] = 0;    /* ensure data is terminated */
+    if (nNew >= prec->sizv)
+        nNew = prec->sizv - 1; /* truncated string */
+    if (paddr->field_type == DBF_CHAR)
+        prec->val[nNew] = 0;   /* ensure data is terminated */
 
     return 0;
 }
diff --git a/src/std/rec/lsoRecord.c b/src/std/rec/lsoRecord.c
index 271a0c3..52a6f1a 100644
--- a/src/std/rec/lsoRecord.c
+++ b/src/std/rec/lsoRecord.c
@@ -200,9 +200,10 @@ static long put_array_info(DBADDR *paddr, long nNew)
 {
     lsoRecord *prec = (lsoRecord *) paddr->precord;
 
-    if (nNew == prec->sizv)
-        --nNew;             /* truncated string */
-    prec->val[nNew] = 0;    /* ensure data is terminated */
+    if (nNew >= prec->sizv)
+        nNew = prec->sizv - 1; /* truncated string */
+    if (paddr->field_type == DBF_CHAR)
+        prec->val[nNew] = 0;   /* ensure data is terminated */
 
     return 0;
 }
